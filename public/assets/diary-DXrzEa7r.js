import{f as E}from"./fetch-CIEPykbw.js";document.addEventListener("DOMContentLoaded",async function(){const t=localStorage.getItem("token");if(!t){window.location.href="index.html";return}await k(t),document.getElementById("logoutButton").addEventListener("click",function(){localStorage.removeItem("token"),window.location.href="index.html"})});async function k(t){const o="/api/auth/me",e={method:"GET",headers:{Authorization:`Bearer ${t}`}};try{const n=await E(o,e);document.getElementById("name").textContent=n.user.username}catch(n){console.error("Error fetching user name:",n)}}const g=document.getElementById("diary-form");console.log(g);g.addEventListener("submit",v);const I=document.querySelector("#fetchEntries");I.addEventListener("click",p);const l=document.getElementById("editdiaryModal"),B=document.querySelector(".close");document.getElementById("edit-diary-form");B.onclick=()=>l.style.display="none";window.onclick=t=>{t.target===l&&(l.style.display="none")};async function v(t){t.preventDefault();const o=localStorage.getItem("user_id"),e=new FormData(g),n={};e.forEach((d,i)=>{n[i]=d,console.log(n)}),n.user_id=o;try{const d=`/api/entries/diary/${o}`,r={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(n)},a=await fetch(d,r);if(console.log(a),!a.ok)throw new Error("Failed to add entry");g.reset(),alert("Päiväkirjamerkintä lisätty!")}catch(d){console.error("Error adding diary entry:",d.message),alert("Päiväkirjamerkinnän lisääminen epäonnistui, Yritä uudelleen.")}}async function p(){const o=`/api/entries/diary/${localStorage.getItem("user_id")}`,n={method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};E(o,n).then(d=>{w(d)})}function w(t){console.log(t);const o=document.querySelector(".tbody");o.innerHTML="",t.forEach(e=>{console.log(e.diary_id,e.user_id,e.entry_date);const n=document.createElement("tr"),d=new Date(e.entry_date).toLocaleDateString("fi-Fi"),i=document.createElement("td");i.innerText=d;const r=document.createElement("td");r.innerText=e.mood;const a=document.createElement("td");a.innerText=e.training_time;const u=document.createElement("td");u.innerText=e.notes;const m=document.createElement("td");m.innerText=e.goals;const y=document.createElement("td"),s=document.createElement("button");s.className="del",s.setAttribute("diary-id",e.diary_id),s.innerText="Poista",s.addEventListener("click",f),y.appendChild(s);const h=document.createElement("td"),c=document.createElement("button");c.className="edit",c.setAttribute("diary-id",e.diary_id),c.setAttribute("data-entry-id",e.diary_id),c.innerText="Muokkaa",c.addEventListener("click",()=>S(e)),h.appendChild(c),n.appendChild(i),n.appendChild(r),n.appendChild(a),n.appendChild(u),n.appendChild(m),n.appendChild(y),n.appendChild(h),o.appendChild(n)}),document.querySelectorAll(".del").forEach(e=>e.addEventListener("click",f))}function S(t){document.getElementById("edit-entry-date").value=new Date(t.entry_date).toISOString().split("T")[0],document.getElementById("edit-mood").value=t.mood,document.getElementById("edit-training-time").value=t.training_time,document.getElementById("edit-notes").value=t.notes,document.getElementById("edit-goals").value=t.goals,document.getElementById("edit-diary-id").value=t.diary_id,document.getElementById("edit-diary-form").addEventListener("submit",T),l.style.display="block"}async function T(t){t.preventDefault(),console.log("Päivitetään merkintä"),console.log(t);const e=`/api/entries/diary/${document.getElementById("edit-diary-id").value}`,n=localStorage.getItem("token"),d=document.getElementById("edit-entry-date").value,i=document.getElementById("edit-mood").value,r=document.getElementById("edit-training-time").value,a=document.getElementById("edit-notes").value,u=document.getElementById("edit-goals").value,m={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({entry_date:d,mood:i,training_time:r,notes:a,goals:u})};E(e,m).then(y=>{console.log(y),alert("Merkinnän päivitys onnistunut!"),l.style.display="none",p()})}async function f(t){console.log(t);const o=t.target.attributes["diary-id"].value;console.log(o);const e=`/api/entries/diary/${o}`,d={method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("token")}};confirm("Haluatko varmasti poistaa merkinnän?")&&E(e,d).then(r=>{console.log(r),p()})}document.getElementById("fetchEntries").addEventListener("click",p);
